# SunGather Configuration for Home Assistant Add-on
# For full configuration options see: https://github.com/bohdan-s/SunGather/blob/main/SunGather/config-example.yaml
inverter:
  host: null
  port: 502
  timeout: 10
  retries: 3
  slave: 0x01
  scan_interval: 30
  connection: modbus
  # model: null
  # serial: null
  smart_meter: true
  use_local_time: true
  log_console: "INFO"
  log_file: "OFF"
  level: 1

exports:
  # Print Registers to console, good for debugging / troubleshooting
  - name: console
    enabled: false

  # Runs a simple Webserver showing Config and last read registers
  - name: webserver
    enabled: true
    port: 8099

  # Publish Registers to MQTT / Home Assistant
  - name: mqtt
    enabled: true
    host: null
    port: 1883
    username: null
    password: null
    # topic: "SunGather/{serial_number}"
    # client_id: null
    homeassistant: true
    ha_sensors:
      - name: "Daily Generation"
        sensor_type: sensor
        register: daily_power_yields
        device_class: energy
        state_class: total_increasing
        icon: "mdi:solar-power"
      - name: "Daily Export to Grid"
        sensor_type: sensor
        register: daily_export_to_grid
        device_class: energy
        state_class: total_increasing
        icon: "mdi:transmission-tower-export"
        value_template: "{{ value_json.daily_export_to_grid | round(2) }}"
      - name: "Daily Import from Grid"
        sensor_type: sensor
        register: daily_import_from_grid
        device_class: energy
        state_class: total_increasing
        icon: "mdi:transmission-tower-import"
        value_template: "{{ value_json.daily_import_from_grid | round(2) }}"
      - name: "Temperature"
        sensor_type: sensor
        register: internal_temperature
        device_class: temperature
        state_class: measurement
      - name: "Power State"
        sensor_type: binary_sensor
        register: run_state
        device_class: running
        payload_on: "ON"
        payload_off: "OFF"
      - name: "Active Generation"
        sensor_type: sensor
        register: total_active_power
        dev_class: power
        state_class: measurement
        icon: "mdi:solar-power"
      - name: "Active Export to Grid"
        sensor_type: sensor
        register: export_to_grid
        dev_class: power
        state_class: measurement
        icon: "mdi:transmission-tower-export"
      - name: "Active Import from Grid"
        sensor_type: sensor
        register: import_from_grid
        dev_class: power
        state_class: measurement
        icon: "mdi:transmission-tower-import"

  # Home Assistant direct integration
  - name: hassio
    enabled: false
    api_url: "http://supervisor/core/api"
    token: null

  # Output data to InfluxDB
  - name: influxdb
    enabled: false
    url: "http://localhost:8086"
    token: null
    username: null
    password: null
    org: "Default"
    bucket: "SunGather"
    measurements:
      - point: "power"
        register: daily_power_yields
      - point: "power"
        register: total_active_power
      - point: "power"
        register: load_power
      - point: "power"
        register: meter_power
      - point: "power"
        register: export_to_grid
      - point: "power"
        register: import_from_grid
      - point: "temp"
        register: internal_temperature

  # Publish Registers to PVOutput
  - name: pvoutput
    enabled: false
    api: null
    sid: null
    join_team: true
    rate_limit: 60
    cumulative_flag: 2
    batch_points: 1
    parameters:
      - name: v1
        register: daily_power_yields
        multiple: 1000
      - name: v2
        register: total_active_power
      - name: v4
        register: load_power
      - name: v6
        register: phase_a_voltage

  # Push data to ChargeHQ for EV charging optimization
  - name: chargehq
    enabled: false
    api_key: null
    push_interval: 60
    register_production: total_active_power
    register_consumption: load_power
    register_net_import: meter_power
    register_battery_power: null
    register_battery_soc: null
    invert_net_import: false
